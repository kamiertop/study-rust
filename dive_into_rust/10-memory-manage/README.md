# 堆和栈

- 内存的虚拟地址空间一般被分割成好几个区域, 称之为段
	- 代码段: 编译后的机器码存在的区域, 只读
	- bss段: 存放未初始化的全局变量和静态变量的区域
	- 数据段: 存放有初始化的全局全量和静态变量的区域
	- 函数调用栈: 存放函数参数, 局部变量以及其他函数调用相关信息的区域
	- 堆: 存放动态分配内存的区域
- 堆和栈
	- 栈上保存的局部变量在退出当前作用域的时候会自动释放
	- 堆上分配的空间没有作用域, 需要手动释放.(操作系统提供了在堆上分配和释放内存的系统调用)
- 进程空间中的每个段通过硬件MMU映射到真正的物理空间: 映射过程中, 还可以给不同的段设置不同的访问权限
	- 违反权限, CPU产生一个硬件异常, 硬件异常被操作系统内核处理, 内核向对应的进程发送一条信号
	- 如果没有实现特殊的信号处理函数, 默认会非正常退出
	- 如果打开了core dump功能, 在进程退出的时候操作系统会把它当时的内存状态, 寄存器状态以及各种相关信息保存到一个文件中
- 内存不安全
	- 空指针: 解引用空指针, 对空指针解引用在大部分平台会产生segfault
	- 野指针: 既未初始化的指针, 它的值 取决于这个位置以前遗留下来的是什么值, 解引用全凭运气
	- 悬空指针: 既内存空间在被释放了之后继续使用, 跟野指针类似, 会读写不属于这个指针的内容
	- 使用未初始化的内存: 不只是指针类型
	- 非法释放: 内存分配和释放要配对
	- 缓冲区溢出: 指针访问越界, 结果类似野指针, 会读取或者修改临近内存空间的值
	- 执行非法函数指针: 如果一个函数指针不是准确地指向一个函数地址, 调用这个函数指针会导致一段随机数据被当成指令来执行
	- 数据竞争